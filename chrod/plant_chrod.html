<html>
<head>
        <meta charset="utf-8">
        <title>Chord</title>
  <style>

.chord path {
  fill-opacity: 0.67;
  stroke: #000;
  stroke-width: 0.5px;
}

</style>
</head>


    <body>
    <script src="../lib/d3.v3.min.js"> </script>

        <script>

        //1.定义数据
        // 城市名
        // var city_name = [ "北京" , "上海" , "广州" , "深圳" , "香港"  ];

        // var city_name = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82"];

        // var city_name = ["1","2","3","4","5","6","7","8","9","10"];
        // var city_name = ["4320", "4360", "4650", "4670", "46D0", "46D1", "46G0", "4710", "4720", "4732"];
        // var city_name = ["4320", "4360", "4650", "4670", "46D0", "46D1", "46G0", "4710", "4720"];
        var city_name = ['', '', '', '', '', '', '', '', ''];

        // 城市人口的来源，如
        //              北京      上海
        //  北京      1000        3045
        //  上海      3214        2000
        // 表示北京市的人口有1000个人来自本地，有3045人是来自上海的移民，总人口为 1000 + 3045
        // 上海市的人口有2000个人来自本地，有3214人是来自北京的移民，总人口为 3214 + 2000
        // var population = [
        //     [700.00,603.71,561.55,574.40,573.61,573.61,574.35,191.51,307.40,461.34],
        //     [603.71,700.00,602.10,622.56,621.29,621.30,621.99,200.64,319.43,482.79],
        //     [561.55,602.10,700.00,627.39,622.27,622.27,637.99,202.46,320.91,483.14],
        //     [574.40,622.56,627.39,700.00,668.56,668.57,660.78,205.88,326.33,495.12],
        //     [573.61,621.29,622.27,668.56,700.00,699.80,658.33,205.68,326.07,494.64],
        //     [573.61,621.30,622.27,668.57,699.80,700.00,658.34,205.68,326.07,494.64],
        //     [574.35,621.99,637.99,660.78,658.33,658.34,700.00,205.12,325.33,493.31],
        //     [191.51,200.64,202.46,205.88,205.68,205.68,205.12,700.00,173.02,171.82],
        //     [307.40,319.43,320.91,326.33,326.07,326.07,325.33,173.02,700.00,279.46],
        //     [461.34,482.79,483.14,495.12,494.64,494.64,493.31,171.82,279.46,700.00]

        // ];

        var population =
        [[    0.        ,  3796.25834261,    62.08427061,  3798.26794919,
         3794.80384758,  3429.57591871,  3420.72437463,  3401.84299579,
         1205.38750485],
       [ 3796.25834261,     0.        ,    65.825928  ,  3797.76393202,
         3797.76393202,  3433.3175761 ,  3424.46571395,  3405.55735525,
         1208.85044816],
       [   62.08427061,    65.825928  ,     0.        ,    63.68778071,
           66.89445635,   432.5083519 ,   441.32436815,   457.02213588,
         2141.68760482],
       [ 3798.26794919,  3797.76393202,    63.68778071,     0.        ,
         3796.53589838,  3431.17890516,  3422.32156535,  3403.51292581,
         1207.1195554 ],
       [ 3794.80384758,  3797.76393202,    66.89445635,  3796.53589838,
            0.        ,  3434.38134621,  3425.51235   ,  3406.85117322,
         1210.5836565 ],
       [ 3429.57591871,  3433.3175761 ,   432.5083519 ,  3431.17890516,
         3434.38134621,     0.        ,  3789.90049506,  3746.13906796,
         1543.89716546],
       [ 3420.72437463,  3424.46571395,   441.32436815,  3422.32156535,
         3425.51235   ,  3789.90049506,     0.        ,  3746.68021005,
         1550.39959104],
       [ 3401.84299579,  3405.55735525,   457.02213588,  3403.51292581,
         3406.85117322,  3746.13906796,  3746.68021005,     0.        ,
         1586.74425337],
       [ 1205.38750485,  1208.85044816,  2141.68760482,  1207.1195554 ,
         1210.5836565 ,  1543.89716546,  1550.39959104,  1586.74425337,
            0.        ]];

        //2.转换数据，并输出转换后的数据
        var chord_layout = d3.layout.chord()
                             .padding(0.03)
                             .sortSubgroups(d3.descending)
                             .matrix(population);

        console.log(chord_layout.groups());
        console.log(chord_layout.chords());

        //3.SVG，弦图，颜色函数的定义
        var width  = 800;
        var height = 800;
        var innerRadius = width/2 * 0.7;
        var outerRadius = innerRadius * 1.1;

        var color20 = d3.scale.category20();

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width/2 + "," + height/2 + ")");

        //4.绘制外部弦（即分组，有多少个城市画多少个弦），及绘制城市名称
        var outer_arc =  d3.svg.arc()
                     .innerRadius(innerRadius)
                     .outerRadius(outerRadius);

        var g_outer = svg.append("g");

        g_outer.selectAll("path")
                .data(chord_layout.groups)
                .enter()
                .append("path")
                .style("fill", function(d) { return color20(d.index); })
                .style("stroke", function(d) { return color20(d.index); })
                .attr("d", outer_arc );

        g_outer.selectAll("text")
                .data(chord_layout.groups)
                .enter()
                .append("text")
                .each( function(d,i) {
                    d.angle = (d.startAngle + d.endAngle) / 2;
                    d.name = city_name[i];
                })
                .attr("dy",".35em")
                .attr("transform", function(d){
                    return "rotate(" + ( d.angle * 180 / Math.PI ) + ")" +
                           "translate(0,"+ -1.0*(outerRadius+10) +")" +
                            ( ( d.angle > Math.PI*3/4 && d.angle < Math.PI*5/4 ) ? "rotate(180)" : "");
                })
                .text(function(d){
                    return d.name;
                });


        //5.绘制内部弦（即所有城市人口的来源，即有5*5=25条弧）
        var inner_chord =  d3.svg.chord()
                        .radius(innerRadius);

        svg.append("g")
            .attr("class", "chord")
            .selectAll("path")
            .data(chord_layout.chords)
            .enter()
            .append("path")
            .attr("d", inner_chord )
            .style("fill", function(d) { return color20(d.source.index); })
            .style("opacity", 1)
            .on("mouseover",function(d,i){
                d3.select(this)
                    .style("fill","yellow");
            })
            .on("mouseout",function(d,i) {
                d3.select(this)
                    .transition()
                    .duration(1000)
                    .style("fill",color20(d.source.index));
            });

        </script>
        </body>
        </html>